# Описание оптимизаций Dockerfile

Этот файл описывает оптимизации, примененные к `Dockerfile` по сравнению с `Dockerfile.original`.

## Примененные оптимизации

1.  **Выбор легковесного базового образа (`FROM python:3.9-slim-buster`)**
    *   **Изменение:** Вместо `ubuntu:latest` используется `python:3.9-slim-buster`.
    *   **Причина:** Образы `-slim` значительно меньше полных образов Debian/Ubuntu, что уменьшает размер финального Docker-образа и сокращает время его скачивания/сборки. Образ `python:3.9-slim-buster` уже содержит предустановленный Python 3.9 и pip, устраняя необходимость их установки через `apt-get`, как в оригинальном файле.

2.  **Удаление ненужных команд установки (`apt-get`)**
    *   **Изменение:** Удалены команды `RUN apt-get update`, `RUN apt-get install -y wget`, `RUN apt-get install -y python3`, `RUN apt-get install -y python3-pip`.
    *   **Причина:** `python3` и `python3-pip` уже есть в базовом образе `python:3.9-slim-buster`. Пакет `wget` не использовался скриптами, поэтому его установка избыточна. `apt-get update` также не нужен, так как никаких пакетов через `apt-get` больше не устанавливается. Это уменьшает количество слоев и размер образа.

3.  **Использование `WORKDIR`**
    *   **Изменение:** Добавлена инструкция `WORKDIR /app`.
    *   **Причина:** Задает рабочий каталог внутри контейнера. Это лучшая практика, чем выполнение команд и копирование файлов в корневые директории или `/tmp`, так как делает Dockerfile более читаемым и предотвращает засорение корневой файловой системы контейнера.

4.  **Копирование только необходимых файлов**
    *   **Изменение:** Вместо `COPY search_path.sh`, `COPY extract_path_value.py` и `COPY config.txt` в `/tmp`, копируются только `search_complex.py` и `config.txt` в `WORKDIR` (`/app`).
    *   **Причина:** Оригинальный Dockerfile копировал скрипты, имена которых не совпадали с созданными в Задании 2. Оптимизированный файл копирует актуальный скрипт `search_complex.py` и файл данных `config.txt`, которые действительно нужны для работы. Копирование только необходимых файлов уменьшает размер образа и предотвращает попадание ненужных артефактов в контейнер.

5.  **Запуск от непривилегированного пользователя (`USER appuser`)**
    *   **Изменение:** Добавлены команды `RUN groupadd...`, `RUN useradd...`, `RUN chown...` и `USER appuser`.
    *   **Причина:** Создается специальный пользователь `appuser` без root-прав, и приложение запускается от его имени. Запуск контейнеров от root-пользователя является плохой практикой с точки зрения безопасности. Если злоумышленник сможет эксплуатировать уязвимость в приложении, он получит root-доступ внутри контейнера. Запуск от непривилегированного пользователя значительно снижает этот риск.

6.  **Минимизация количества слоев**
    *   **Изменение:** Хотя в оригинальном файле было много отдельных `RUN` команд для `apt-get`, в оптимизированном файле они удалены. Оставшиеся команды `RUN` (создание пользователя, chmod, chown) сгруппированы логически, но не объединены чрезмерно, чтобы сохранить читаемость и использовать кэширование там, где это возможно.
    *   **Причина:** Каждый `RUN`, `COPY`, `ADD` создает новый слой в Docker-образе. Уменьшение количества слоев может немного ускорить сборку и передачу образа, хотя современные хранилища Docker эффективно справляются с большим количеством слоев. Главное преимущество здесь - удаление ненужных команд `RUN apt-get`.

7.  **Установка прав доступа (`RUN chmod +x`)**
    *   **Изменение:** Команда `RUN chmod +x` применена только к `search_complex.py`.
    *   **Причина:** Делает скрипт исполняемым напрямую (например, `./search_complex.py`), что соответствует наличию shebang (`#!/usr/bin/env python3`) в скрипте. В оригинальном файле `chmod` применялся к скриптам, которые не были скопированы.

8.  **Использование `CMD` в формате exec**
    *   **Изменение:** Добавлена инструкция `CMD ["./search_complex.py", "config.txt", "path"]`.
    *   **Причина:** Определяет команду, которая будет выполняться по умолчанию при запуске контейнера. Использование формата JSON array (`exec form`) предпочтительнее, чем `shell form` (`CMD ./search_complex.py ...`), так как оно позволяет избежать запуска лишней оболочки и корректно обрабатывать сигналы.

## Как собрать и запустить

1.  Убедитесь, что у вас установлен Docker.
2.  Перейдите в директорию `task_3_docker`.
3.  Соберите образ:
    ```bash
    docker build -t search-app .
    ```
4.  Запустите контейнер (он выполнит поиск слова "path" в файле `config.txt` по умолчанию):
    ```bash
    docker run --rm search-app
    ```
5.  Запустите контейнер с другими параметрами (например, поиск слова "port" без учета регистра):
    ```bash
    docker run --rm search-app ./search_complex.py config.txt port -i
    ```
